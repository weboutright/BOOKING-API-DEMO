<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking System - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="config.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50" x-data="adminDashboard()">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <i class="fas fa-calendar-alt text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold">Booking Admin</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="refreshData()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                    <div class="flex items-center space-x-2 bg-white/20 px-3 py-2 rounded-lg">
                        <i class="fab fa-google text-sm"></i>
                        <span x-show="userInfo" class="text-sm" x-text="userInfo?.email || 'Admin User'"></span>
                    </div>
                    <button @click="logout()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Navigation Tabs -->
        <div class="mb-8">
            <nav class="flex space-x-8" role="tablist">
                <button @click="activeTab = 'dashboard'" 
                        :class="activeTab === 'dashboard' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </button>
                <button @click="activeTab = 'calendar'" 
                        :class="activeTab === 'calendar' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <i class="fas fa-calendar-plus mr-2"></i>Calendar Management
                </button>
                <button @click="activeTab = 'settings'" 
                        :class="activeTab === 'settings' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <i class="fas fa-cog mr-2"></i>Settings
                </button>
                <button @click="activeTab = 'bookings'" 
                        :class="activeTab === 'bookings' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <i class="fas fa-list mr-2"></i>View Bookings
                </button>
            </nav>
        </div>

        <!-- Dashboard Tab -->
        <div x-show="activeTab === 'dashboard'" class="space-y-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-calendar-check text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Today's Bookings</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.todayBookings">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <i class="fas fa-chart-line text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">This Week</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.weekBookings">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                            <i class="fas fa-ban text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Blocked Slots</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.blockedSlots">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-red-100 text-red-600">
                            <i class="fas fa-clock text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Available Today</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.availableToday">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button @click="activeTab = 'calendar'; showBlockForm = true" 
                            class="flex items-center p-4 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors">
                        <i class="fas fa-ban text-indigo-600 mr-3"></i>
                        <span class="font-medium text-indigo-700">Block Time Slot</span>
                    </button>
                    <button @click="activeTab = 'settings'" 
                            class="flex items-center p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                        <i class="fas fa-cog text-green-600 mr-3"></i>
                        <span class="font-medium text-green-700">Update Settings</span>
                    </button>
                    <button @click="exportBookings()" 
                            class="flex items-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">
                        <i class="fas fa-download text-purple-600 mr-3"></i>
                        <span class="font-medium text-purple-700">Export Data</span>
                    </button>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
                <div class="space-y-4" x-show="recentActivity.length > 0">
                    <template x-for="activity in recentActivity" :key="activity.id">
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                            <div class="p-2 rounded-full" :class="activity.type === 'booking' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'">
                                <i :class="activity.type === 'booking' ? 'fas fa-plus' : 'fas fa-minus'" class="text-sm"></i>
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="text-sm font-medium text-gray-900" x-text="activity.message"></p>
                                <p class="text-xs text-gray-500" x-text="activity.timestamp"></p>
                            </div>
                        </div>
                    </template>
                </div>
                <div x-show="recentActivity.length === 0" class="text-center py-8 text-gray-500">
                    <i class="fas fa-inbox text-3xl mb-3"></i>
                    <p>No recent activity</p>
                </div>
            </div>
        </div>

        <!-- Calendar Management Tab -->
        <div x-show="activeTab === 'calendar'" class="space-y-6">
            <!-- Block Time Form -->
            <div x-show="showBlockForm" class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Block Time Slots</h3>
                    <button @click="showBlockForm = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="blockTimeSlot()" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" x-model="blockForm.date" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                        <input type="time" x-model="blockForm.startTime" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                        <input type="time" x-model="blockForm.endTime" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="flex items-end">
                        <button type="submit" :disabled="isLoading"
                                class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white py-2 px-4 rounded-lg transition-colors">
                            <span x-show="!isLoading">Block Time</span>
                            <span x-show="isLoading">Blocking...</span>
                        </button>
                    </div>
                </form>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reason (Optional)</label>
                    <input type="text" x-model="blockForm.reason" placeholder="e.g., Personal appointment, Holiday, etc."
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
            </div>

            <!-- Quick Block Options -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Block Options</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button @click="blockEntireDay()" class="p-4 border-2 border-dashed border-gray-300 hover:border-indigo-400 rounded-lg transition-colors">
                        <i class="fas fa-calendar-times text-2xl text-gray-400 mb-2"></i>
                        <p class="font-medium text-gray-700">Block Entire Day</p>
                        <p class="text-sm text-gray-500">Block all slots for a specific date</p>
                    </button>
                    <button @click="blockWeekend()" class="p-4 border-2 border-dashed border-gray-300 hover:border-indigo-400 rounded-lg transition-colors">
                        <i class="fas fa-calendar-week text-2xl text-gray-400 mb-2"></i>
                        <p class="font-medium text-gray-700">Block Weekend</p>
                        <p class="text-sm text-gray-500">Block Saturday and Sunday</p>
                    </button>
                    <button @click="blockHolidays()" class="p-4 border-2 border-dashed border-gray-300 hover:border-indigo-400 rounded-lg transition-colors">
                        <i class="fas fa-gift text-2xl text-gray-400 mb-2"></i>
                        <p class="font-medium text-gray-700">Block Holidays</p>
                        <p class="text-sm text-gray-500">Block common holidays</p>
                    </button>
                </div>
            </div>

            <!-- Blocked Slots List -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Blocked Time Slots</h3>
                    <button @click="showBlockForm = !showBlockForm" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Block
                    </button>
                </div>
                <div class="space-y-3" x-show="blockedSlots.length > 0">
                    <template x-for="slot in blockedSlots" :key="slot.id">
                        <div class="flex items-center justify-between p-4 bg-red-50 border-l-4 border-red-400 rounded">
                            <div class="flex-1">
                                <p class="font-medium text-gray-900" x-text="slot.date + ' ' + slot.startTime + ' - ' + slot.endTime"></p>
                                <p class="text-sm text-gray-600" x-text="slot.reason || 'No reason specified'"></p>
                            </div>
                            <button @click="unblockSlot(slot.id)" class="text-red-600 hover:text-red-800 p-2">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </template>
                </div>
                <div x-show="blockedSlots.length === 0" class="text-center py-8 text-gray-500">
                    <i class="fas fa-calendar-check text-3xl mb-3"></i>
                    <p>No blocked time slots</p>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div x-show="activeTab === 'settings'" class="space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Booking Settings</h3>
                <form @submit.prevent="saveSettings()" class="space-y-6">
                    <!-- Business Hours -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-4">Business Hours</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                <input type="time" x-model="settings.businessHours.start"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                                <input type="time" x-model="settings.businessHours.end"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                    </div>

                    <!-- Working Days -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-4">Working Days</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <template x-for="day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']">
                                <label class="flex items-center">
                                    <input type="checkbox" :value="day" x-model="settings.workingDays"
                                           class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="ml-2 text-sm text-gray-700" x-text="day"></span>
                                </label>
                            </template>
                        </div>
                    </div>

                    <!-- Appointment Duration -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Default Appointment Duration (minutes)</label>
                        <select x-model="settings.appointmentDuration"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                            <option value="90">90 minutes</option>
                            <option value="120">120 minutes</option>
                        </select>
                    </div>

                    <!-- Advance Booking -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Maximum days in advance for booking</label>
                        <input type="number" x-model="settings.maxAdvanceDays" min="1" max="365"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <!-- Minimum Notice -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Minimum notice required (hours)</label>
                        <input type="number" x-model="settings.minNoticeHours" min="0" max="168"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div class="flex justify-end">
                        <button type="submit" :disabled="isLoading"
                                class="bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white py-2 px-6 rounded-lg transition-colors">
                            <span x-show="!isLoading">Save Settings</span>
                            <span x-show="isLoading">Saving...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Calendar Integration -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Calendar Integration</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Calendar ID</label>
                        <input type="text" x-model="settings.calendarId" placeholder="primary or your-email@gmail.com"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <p class="text-xs text-gray-500 mt-1">Use 'primary' for your main calendar or the specific calendar ID</p>
                    </div>
                    <button @click="testCalendarConnection()" type="button"
                            class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-plug mr-2"></i>Test Connection
                    </button>
                </div>
            </div>
        </div>

        <!-- Bookings Tab -->
        <div x-show="activeTab === 'bookings'" class="space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">All Bookings</h3>
                    <button @click="loadBookings()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
                
                <!-- Filter Options -->
                <div class="mb-6 flex flex-wrap gap-4">
                    <select x-model="bookingFilter" @change="filterBookings()"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="all">All Bookings</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="upcoming">Upcoming</option>
                    </select>
                </div>

                <!-- Bookings List -->
                <div class="space-y-4" x-show="filteredBookings.length > 0">
                    <template x-for="booking in filteredBookings" :key="booking.id">
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900" x-text="booking.title"></h4>
                                    <p class="text-sm text-gray-600 mt-1">
                                        <i class="fas fa-user mr-2"></i><span x-text="booking.clientName"></span>
                                        <span class="mx-2">•</span>
                                        <i class="fas fa-envelope mr-2"></i><span x-text="booking.clientEmail"></span>
                                    </p>
                                    <p class="text-sm text-gray-600 mt-1">
                                        <i class="fas fa-calendar mr-2"></i><span x-text="booking.date"></span>
                                        <span class="mx-2">•</span>
                                        <i class="fas fa-clock mr-2"></i><span x-text="booking.startTime + ' - ' + booking.endTime"></span>
                                    </p>
                                    <p x-show="booking.notes" class="text-sm text-gray-500 mt-2" x-text="booking.notes"></p>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="editBooking(booking)" class="text-indigo-600 hover:text-indigo-800 p-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button @click="cancelBooking(booking)" class="text-red-600 hover:text-red-800 p-2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <div x-show="filteredBookings.length === 0" class="text-center py-12 text-gray-500">
                    <i class="fas fa-calendar-times text-4xl mb-4"></i>
                    <p class="text-lg">No bookings found</p>
                    <p class="text-sm">Bookings will appear here once customers start booking appointments</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages/Alerts -->
    <div x-show="message.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed bottom-4 right-4 z-50">
        <div :class="message.type === 'success' ? 'bg-green-500' : message.type === 'error' ? 'bg-red-500' : 'bg-blue-500'"
             class="text-white px-6 py-3 rounded-lg shadow-lg flex items-center">
            <i :class="message.type === 'success' ? 'fas fa-check-circle' : message.type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle'"
               class="mr-2"></i>
            <span x-text="message.text"></span>
            <button @click="message.show = false" class="ml-4 hover:opacity-75">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        function adminDashboard() {
            return {
                activeTab: 'dashboard',
                isLoading: false,
                showBlockForm: false,
                
                // Get API URL from config
                API_URL: typeof ACTIVE_CONFIG !== 'undefined' ? ACTIVE_CONFIG.API_URL : 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE',
                
                // Admin authentication via Google
                isAuthenticated: false,
                userInfo: null,
                
                stats: {
                    todayBookings: 0,
                    weekBookings: 0,
                    blockedSlots: 0,
                    availableToday: 8
                },
                
                recentActivity:     [],
                blockedSlots: [],
                bookings: [],
                filteredBookings: [],
                bookingFilter: 'all',
                
                blockForm: {
                    date: '',
                    startTime: '',
                    endTime: '',
                    reason: ''
                },
                
                settings: {
                    businessHours: { start: '09:00', end: '17:00' },
                    workingDays: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
                    appointmentDuration: 60,
                    maxAdvanceDays: 30,
                    minNoticeHours: 2,
                    calendarId: 'primary'
                },
                
                message: {
                    show: false,
                    type: 'info',
                    text: ''
                },
                
                async init() {
                    // Check authentication
                    const authToken = sessionStorage.getItem('adminAuth');
                    const userInfoStr = sessionStorage.getItem('adminUserInfo');
                    
                    if (!authToken || authToken !== 'google-authenticated') {
                        // Redirect to login if not authenticated
                        window.location.href = 'admin-login.html';
                        return;
                    }
                    
                    if (userInfoStr) {
                        this.userInfo = JSON.parse(userInfoStr);
                    }
                    
                    this.isAuthenticated = true;
                    await this.loadInitialData();
                },
                
                async loadInitialData() {
                    try {
                        await Promise.all([
                            this.loadStats(),
                            this.loadBlockedSlots(),
                            this.loadBookings(),
                            this.loadSettings()
                        ]);
                    } catch (error) {
                        this.showMessage('Error loading data: ' + error.message, 'error');
                    }
                },
                
                async loadStats() {
                    // Simulate loading stats - replace with actual API call
                    this.stats = {
                        todayBookings: 3,
                        weekBookings: 12,
                        blockedSlots: this.blockedSlots.length,
                        availableToday: 5
                    };
                },
                
                async loadBlockedSlots() {
                    // Simulate loading blocked slots - replace with actual API call
                    this.blockedSlots = [
                        { id: 1, date: '2024-01-15', startTime: '12:00', endTime: '13:00', reason: 'Lunch break' },
                        { id: 2, date: '2024-01-20', startTime: '09:00', endTime: '17:00', reason: 'Personal day' }
                    ];
                },
                
                async loadBookings() {
                    // Simulate loading bookings - replace with actual API call
                    this.bookings = [
                        {
                            id: 1,
                            title: 'Discovery Consultation',
                            clientName: 'John Doe',
                            clientEmail: 'john@example.com',
                            date: '2024-01-16',
                            startTime: '10:00',
                            endTime: '11:00',
                            notes: 'Interested in web development services'
                        }
                    ];
                    this.filterBookings();
                },
                
                async loadSettings() {
                    // Load settings from Apps Script properties service
                    // This would be implemented in the backend
                },
                
                async blockTimeSlot() {
                    this.isLoading = true;
                    try {
                        // Here you would call your Apps Script API
                        const response = await fetch(this.API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: 'blockSlot',
                                data: this.blockForm
                            })
                        });
                        
                        if (response.ok) {
                            this.blockedSlots.push({
                                id: Date.now(),
                                ...this.blockForm
                            });
                            this.blockForm = { date: '', startTime: '', endTime: '', reason: '' };
                            this.showBlockForm = false;
                            this.showMessage('Time slot blocked successfully', 'success');
                        }
                    } catch (error) {
                        this.showMessage('Error blocking time slot: ' + error.message, 'error');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                async unblockSlot(slotId) {
                    if (confirm('Are you sure you want to unblock this time slot?')) {
                        try {
                            // API call to unblock slot
                            this.blockedSlots = this.blockedSlots.filter(slot => slot.id !== slotId);
                            this.showMessage('Time slot unblocked successfully', 'success');
                        } catch (error) {
                            this.showMessage('Error unblocking time slot: ' + error.message, 'error');
                        }
                    }
                },
                
                async saveSettings() {
                    this.isLoading = true;
                    try {
                        // API call to save settings
                        this.showMessage('Settings saved successfully', 'success');
                    } catch (error) {
                        this.showMessage('Error saving settings: ' + error.message, 'error');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                async testCalendarConnection() {
                    try {
                        this.showMessage('Testing calendar connection...', 'info');
                        // API call to test calendar
                        setTimeout(() => {
                            this.showMessage('Calendar connection successful', 'success');
                        }, 2000);
                    } catch (error) {
                        this.showMessage('Calendar connection failed: ' + error.message, 'error');
                    }
                },
                
                filterBookings() {
                    const now = new Date();
                    const today = now.toISOString().split('T')[0];
                    
                    switch (this.bookingFilter) {
                        case 'today':
                            this.filteredBookings = this.bookings.filter(b => b.date === today);
                            break;
                        case 'week':
                            // Filter for current week
                            this.filteredBookings = this.bookings;
                            break;
                        case 'month':
                            // Filter for current month
                            this.filteredBookings = this.bookings;
                            break;
                        case 'upcoming':
                            this.filteredBookings = this.bookings.filter(b => b.date >= today);
                            break;
                        default:
                            this.filteredBookings = this.bookings;
                    }
                },
                
                async refreshData() {
                    this.isLoading = true;
                    try {
                        await this.loadInitialData();
                        this.showMessage('Data refreshed successfully', 'success');
                    } catch (error) {
                        this.showMessage('Error refreshing data: ' + error.message, 'error');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                exportBookings() {
                    // Export bookings to CSV
                    const csv = this.convertToCSV(this.bookings);
                    this.downloadCSV(csv, 'bookings.csv');
                    this.showMessage('Bookings exported successfully', 'success');
                },
                
                convertToCSV(data) {
                    const header = 'Date,Time,Client Name,Email,Notes\n';
                    const rows = data.map(booking => 
                        `${booking.date},${booking.startTime}-${booking.endTime},"${booking.clientName}","${booking.clientEmail}","${booking.notes || ''}"`
                    ).join('\n');
                    return header + rows;
                },
                
                downloadCSV(csv, filename) {
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    window.URL.revokeObjectURL(url);
                },
                
                showMessage(text, type = 'info') {
                    this.message = { show: true, text, type };
                    setTimeout(() => {
                        this.message.show = false;
                    }, 5000);
                },
                
                logout() {
                    // Clear authentication
                    sessionStorage.removeItem('adminAuth');
                    sessionStorage.removeItem('adminUserInfo');
                    
                    // Redirect to login
                    window.location.href = 'admin-login.html';
                },
                
                // Quick action methods
                blockEntireDay() {
                    const today = new Date().toISOString().split('T')[0];
                    this.blockForm = {
                        date: today,
                        startTime: '00:00',
                        endTime: '23:59',
                        reason: 'Entire day blocked'
                    };
                    this.showBlockForm = true;
                },
                
                blockWeekend() {
                    this.showMessage('Weekend blocking feature would be implemented here', 'info');
                },
                
                blockHolidays() {
                    this.showMessage('Holiday blocking feature would be implemented here', 'info');
                },
                
                editBooking(booking) {
                    this.showMessage('Edit booking feature would be implemented here', 'info');
                },
                
                cancelBooking(booking) {
                    if (confirm('Are you sure you want to cancel this booking?')) {
                        this.bookings = this.bookings.filter(b => b.id !== booking.id);
                        this.filterBookings();
                        this.showMessage('Booking cancelled successfully', 'success');
                    }
                }
            }
        }
    </script>
</body>
</html>
