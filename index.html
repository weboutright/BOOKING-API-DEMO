<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Discovery Consultation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Configure Tailwind for Calendly-like colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'calendly-blue': '#006bff',
                        'calendly-blue-hover': '#0051cc',
                        'calendly-gray': '#f8f8f8',
                        'calendly-text': '#1a1a1a',
                        'calendly-light-gray': '#666666',
                        'calendly-border': '#e1e1e1',
                        'calendly-success': '#00a2ff',
                        'calendly-error': '#ff4444',
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.2s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3e2c3 100%);
            min-height: 100vh;
        }
        
        .calendly-shadow {
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
        }
        
        .form-step {
            transition: all 0.3s ease;
        }
        
        .form-step.active {
            animation: slide-in 0.3s ease-out;
        }
        
        .time-slot {1:29:50 PM
Notice
Execution started
1:29:50 PM
Info
=== TESTING DOPOST FUNCTION ===
1:29:50 PM
Info
=== NEW BOOKING REQUEST ===
1:29:50 PM
Info
Request received at: 2025-09-27T03:29:50.607Z
1:29:50 PM
Info
Raw request data: {"name":"Test User","email":"test@example.com","date":"2025-09-28","time":"10:00","notes":"Testing the complete flow"}
1:29:50 PM
Info
Parsed booking data: {"name":"Test User","email":"test@example.com","date":"2025-09-28","time":"10:00","notes":"Testing the complete flow"}
1:29:51 PM
Info
Successfully created event: Discovery Consultation: Test User at 9/28/2025, 10:00:00 AM
1:29:51 PM
Info
Response: success - Appointment confirmed for 9/28/2025 at 10:00 AM. A calendar invitation has been sent to test@example.com.
1:29:51 PM
Info
DoPost result: {"status":"success","message":"Appointment confirmed for 9/28/2025 at 10:00 AM. A calendar invitation has been sent to test@example.com.","timestamp":"2025-09-27T03:29:51.402Z","eventId":"hp1ml0k5r8rssm29vb4o12ifu8@google.com"}
1:29:51 PM
Notice
Execution completed
            transition: all 0.2s ease;
        }
        
        .time-slot:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 107, 255, 0.15);
        }
        
        .time-slot.selected {
            background-color: #006bff !important;
            color: white !important;
            transform: scale(1.02);
        }
        
        input:focus {
            outline: none;
            border-color: #006bff;
            box-shadow: 0 0 0 3px rgba(0, 107, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto">
        
        <!-- Header Section -->
        <div class="text-center mb-8 animate-fade-in">
            <div class="mb-4">
                <div class="w-16 h-16 bg-calendly-blue rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-calendly-text mb-2">Discovery Consultation</h1>
                <div class="flex items-center justify-center text-calendly-light-gray mb-3">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-lg">60 minutes</span>
                </div>
                <p class="text-calendly-light-gray max-w-md mx-auto">
                    A dedicated consultation to understand your needs and outline a strategic path forward.
                </p>
            </div>
        </div>

        <!-- Main Booking Interface -->
        <div class="bg-white rounded-2xl calendly-shadow overflow-hidden">
            
            <!-- Progress Steps -->
            <div class="bg-calendly-gray px-6 py-4 border-b border-calendly-border">
                <div class="flex items-center space-x-4">
                    <div id="step-1-indicator" class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-calendly-blue text-white flex items-center justify-center text-sm font-semibold">1</div>
                        <span class="ml-2 text-sm font-medium text-calendly-text">Select Date & Time</span>
                    </div>
                    <div class="flex-1 h-px bg-calendly-border"></div>
                    <div id="step-2-indicator" class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-semibold">2</div>
                        <span class="ml-2 text-sm font-medium text-gray-600">Your Details</span>
                    </div>
                </div>
            </div>

            <!-- Message Box for Feedback -->
            <div id="message-box" class="hidden mx-6 mt-6 p-4 rounded-lg text-sm font-medium" role="alert"></div>
            
            <!-- Multi-step Form -->
            <form id="booking-form" class="p-6">

                <!-- STEP 1: Date & Time Selection -->
                <div id="step-1" class="form-step active">
                    <h2 class="text-2xl font-semibold text-calendly-text mb-6">When would you like to meet?</h2>
                    
                    <!-- Date Selection -->
                    <div class="mb-8">
                        <label class="block text-lg font-medium text-calendly-text mb-4">Select a date</label>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3" id="date-options">
                            <!-- Date options will be populated by JavaScript -->
                        </div>
                        <input type="date" id="date" class="hidden" required>
                    </div>
                    
                    <!-- Time Selection -->
                    <div id="time-selection" class="hidden">
                        <label class="block text-lg font-medium text-calendly-text mb-4">Select a time</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mb-6" id="time-options">
                            <!-- Time slots will be populated by JavaScript -->
                        </div>
                        <input type="time" id="time" class="hidden" required>
                    </div>
                    
                    <!-- Continue Button -->
                    <button type="button" id="continue-btn" class="hidden w-full bg-calendly-blue hover:bg-calendly-blue-hover text-white font-semibold py-4 px-6 rounded-lg transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Continue
                        <svg class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>

                <!-- STEP 2: Contact Information -->
                <div id="step-2" class="form-step hidden">
                    <div class="mb-6">
                        <button type="button" id="back-btn" class="flex items-center text-calendly-blue hover:text-calendly-blue-hover transition duration-200">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                    </div>
                    
                    <h2 class="text-2xl font-semibold text-calendly-text mb-2">Enter your details</h2>
                    <div id="selected-datetime" class="text-calendly-light-gray mb-8"></div>
                    
                    <div class="space-y-6">
                        <!-- Name Input -->
                        <div>
                            <label for="name" class="block text-sm font-medium text-calendly-text mb-2">Full Name *</label>
                            <input type="text" id="name" required 
                                   class="w-full px-4 py-3 border border-calendly-border rounded-lg text-calendly-text placeholder-gray-400 transition duration-200"
                                   placeholder="Enter your full name">
                        </div>

                        <!-- Email Input -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-calendly-text mb-2">Email Address *</label>
                            <input type="email" id="email" required 
                                   class="w-full px-4 py-3 border border-calendly-border rounded-lg text-calendly-text placeholder-gray-400 transition duration-200"
                                   placeholder="Enter your email address">
                        </div>
                        
                        <!-- Optional Notes -->
                        <div>
                            <label for="notes" class="block text-sm font-medium text-calendly-text mb-2">Additional Notes (Optional)</label>
                            <textarea id="notes" rows="4" 
                                      class="w-full px-4 py-3 border border-calendly-border rounded-lg text-calendly-text placeholder-gray-400 transition duration-200 resize-none"
                                      placeholder="Any specific topics you'd like to discuss?"></textarea>
                        </div>
                    </div>

                    <!-- Confirm Button -->
                    <button type="submit" id="submit-button" 
                            class="w-full mt-8 bg-calendly-blue hover:bg-calendly-blue-hover text-white font-semibold py-4 px-6 rounded-lg transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" 
                            disabled>
                        <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span id="button-text">Schedule Meeting</span>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Footer -->
        <div class="text-center mt-8 text-calendly-light-gray">
            <p class="text-sm">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                Secure scheduling powered by Google Apps Script
            </p>
        </div>
    </div>

    <script>
        // *** APPS SCRIPT WEB APP URL ***
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzeQduoEzWXTH7yKUs3FUhTCzQwGFu8X27ksMQGh7YM9ZDBN94eGWi0AwinSEU-Lzm9/exec'; 

        // DOM Elements
        const form = document.getElementById('booking-form');
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const dateOptions = document.getElementById('date-options');
        const timeOptions = document.getElementById('time-options');
        const timeSelection = document.getElementById('time-selection');
        const continueBtn = document.getElementById('continue-btn');
        const backBtn = document.getElementById('back-btn');
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const messageBox = document.getElementById('message-box');
        const selectedDatetime = document.getElementById('selected-datetime');
        const step1Indicator = document.getElementById('step-1-indicator');
        const step2Indicator = document.getElementById('step-2-indicator');
        
        // State variables
        let selectedDate = null;
        let selectedTime = null;
        let currentStep = 1;

        // Available time slots (you can customize these)
        const timeSlots = [
            '09:00', '10:00', '11:00', '12:00', 
            '13:00', '14:00', '15:00', '16:00', '17:00'
        ];

        // --- Initialization ---
        function init() {
            generateDateOptions();
            setupEventListeners();
        }

        function setupEventListeners() {
            continueBtn.addEventListener('click', goToStep2);
            backBtn.addEventListener('click', goToStep1);
            form.addEventListener('submit', handleSubmit);
            
            // Form validation for step 2
            document.getElementById('name').addEventListener('input', validateStep2);
            document.getElementById('email').addEventListener('input', validateStep2);
        }

        // --- Date Generation ---
        function generateDateOptions() {
            const today = new Date();
            const options = [];
            
            // Generate next 14 days (excluding weekends if desired)
            for (let i = 1; i <= 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                // Skip weekends (optional - remove this if you want weekends)
                if (date.getDay() === 0 || date.getDay() === 6) continue;
                
                options.push(date);
                if (options.length >= 8) break; // Limit to 8 options
            }

            dateOptions.innerHTML = '';
            options.forEach(date => {
                const dateButton = createDateButton(date);
                dateOptions.appendChild(dateButton);
            });
        }

        function createDateButton(date) {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'date-option p-4 border-2 border-calendly-border rounded-lg text-center hover:border-calendly-blue hover:bg-blue-50 transition duration-200 focus:outline-none focus:ring-2 focus:ring-calendly-blue focus:ring-opacity-50';
            
            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
            const dayNumber = date.getDate();
            const monthName = date.toLocaleDateString('en-US', { month: 'short' });
            
            button.innerHTML = `
                <div class="font-semibold text-calendly-text">${dayName}</div>
                <div class="text-2xl font-bold text-calendly-text">${dayNumber}</div>
                <div class="text-sm text-calendly-light-gray">${monthName}</div>
            `;
            
            button.addEventListener('click', () => selectDate(date, button));
            return button;
        }

        function selectDate(date, buttonElement) {
            // Remove previous selection
            document.querySelectorAll('.date-option').forEach(btn => {
                btn.classList.remove('border-calendly-blue', 'bg-blue-50', 'selected');
            });
            
            // Add selection to clicked button
            buttonElement.classList.add('border-calendly-blue', 'bg-blue-50', 'selected');
            selectedDate = date;
            
            // Update hidden input
            document.getElementById('date').value = date.toISOString().split('T')[0];
            
            // Show time selection
            generateTimeOptions();
            timeSelection.classList.remove('hidden');
        }

        function generateTimeOptions() {
            timeOptions.innerHTML = '';
            
            timeSlots.forEach(time => {
                const timeButton = createTimeButton(time);
                timeOptions.appendChild(timeButton);
            });
        }

        function createTimeButton(time) {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'time-slot p-3 border border-calendly-border rounded-lg text-center hover:border-calendly-blue transition duration-200 focus:outline-none focus:ring-2 focus:ring-calendly-blue focus:ring-opacity-50';
            button.textContent = formatTime(time);
            
            button.addEventListener('click', () => selectTime(time, button));
            return button;
        }

        function selectTime(time, buttonElement) {
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selection to clicked button
            buttonElement.classList.add('selected');
            selectedTime = time;
            
            // Update hidden input
            document.getElementById('time').value = time;
            
            // Show continue button
            continueBtn.classList.remove('hidden');
            continueBtn.disabled = false;
        }

        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour12 = hours > 12 ? hours - 12 : hours;
            const ampm = hours >= 12 ? 'PM' : 'AM';
            return `${hour12}:${minutes} ${ampm}`;
        }

        // --- Step Navigation ---
        function goToStep2() {
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            step2.classList.add('active');
            currentStep = 2;
            
            // Update progress indicators
            updateProgressIndicators();
            
            // Update selected datetime display
            updateSelectedDatetimeDisplay();
            
            // Validate step 2
            validateStep2();
        }

        function goToStep1() {
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
            step1.classList.add('active');
            currentStep = 1;
            
            // Update progress indicators
            updateProgressIndicators();
        }

        function updateProgressIndicators() {
            if (currentStep === 1) {
                step1Indicator.querySelector('div').className = 'w-8 h-8 rounded-full bg-calendly-blue text-white flex items-center justify-center text-sm font-semibold';
                step1Indicator.querySelector('span').className = 'ml-2 text-sm font-medium text-calendly-text';
                step2Indicator.querySelector('div').className = 'w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-semibold';
                step2Indicator.querySelector('span').className = 'ml-2 text-sm font-medium text-gray-600';
            } else {
                step1Indicator.querySelector('div').className = 'w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center text-sm font-semibold';
                step1Indicator.querySelector('span').className = 'ml-2 text-sm font-medium text-green-600';
                step2Indicator.querySelector('div').className = 'w-8 h-8 rounded-full bg-calendly-blue text-white flex items-center justify-center text-sm font-semibold';
                step2Indicator.querySelector('span').className = 'ml-2 text-sm font-medium text-calendly-text';
                
                // Change step 1 number to checkmark
                step1Indicator.querySelector('div').innerHTML = '✓';
            }
        }

        function updateSelectedDatetimeDisplay() {
            if (selectedDate && selectedTime) {
                const dateStr = selectedDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                const timeStr = formatTime(selectedTime);
                selectedDatetime.textContent = `${dateStr} at ${timeStr}`;
            }
        }

        function validateStep2() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const isValid = name.length >= 2 && email.includes('@') && email.includes('.');
            
            submitButton.disabled = !isValid;
        }

        // --- Message Display ---
        function showMessage(type, message) {
            messageBox.classList.remove('hidden', 'bg-red-50', 'border-red-300', 'text-red-800', 'bg-green-50', 'border-green-300', 'text-green-800');
            messageBox.textContent = message;
            
            if (type === 'success') {
                messageBox.classList.add('bg-green-50', 'border', 'border-green-300', 'text-green-800');
                
                // Show success state
                setTimeout(() => {
                    document.querySelector('.bg-white').innerHTML = `
                        <div class="text-center py-16 px-6">
                            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-calendly-text mb-4">You're all set!</h2>
                            <p class="text-calendly-light-gray mb-6">${message}</p>
                            <button onclick="location.reload()" class="bg-calendly-blue hover:bg-calendly-blue-hover text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                Schedule Another Meeting
                            </button>
                        </div>
                    `;
                }, 1500);
            } else {
                messageBox.classList.add('bg-red-50', 'border', 'border-red-300', 'text-red-800');
            }
            
            messageBox.classList.remove('hidden');
        }

        function setLoading(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
                buttonText.textContent = 'Scheduling...';
            } else {
                loadingSpinner.classList.add('hidden');
                buttonText.textContent = 'Schedule Meeting';
                validateStep2();
            }
        }

        // --- Form Submission ---
        async function handleSubmit(event) {
            event.preventDefault();
            messageBox.classList.add('hidden');

            setLoading(true);

            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                notes: document.getElementById('notes').value.trim()
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.status === 'success') {
                    showMessage('success', result.message);
                } else {
                    showMessage('error', result.message);
                }

            } catch (error) {
                console.error('Booking Error:', error);
                
                let displayMessage = 'Unable to complete booking. Please try again or contact support.';
                
                if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    displayMessage = 'Connection error. Please check your internet connection and try again.';
                } else if (error.message.includes('HTTP error')) {
                    displayMessage = `Server error (${error.message}). Please try again later.`;
                }

                showMessage('error', displayMessage);
            } finally {
                setLoading(false);
            }
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
